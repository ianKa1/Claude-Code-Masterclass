---
name: firestore-schemas
description: |
  Firestore type conventions and patterns for TypeScript projects. Use when: (1) Creating new Firestore document types, (2) Defining collection schemas, (3) Implementing serialization/converters, (4) Setting up type-safe Firestore queries, or (5) Working with Firestore timestamps and type patterns.
---

# Firestore Schemas Skill

Conventions for typing Firestore documents and collections.

## File Location

All Firestore types: **`types/firestore/`**

- One file per entity: `types/firestore/{entity}.ts` (lowercase, singular)
- Barrel export: `types/firestore/index.ts`

## Naming Conventions

### Document Types
- **Document:** `{Entity}` - Firestore document (uses `Date` for date fields)
- **Create Input:** `Create{Entity}Input` - Fields for creation (excludes auto-generated)
- **Update Input:** `Update{Entity}Input` - Partial fields for updates (all optional)

### Collections
Export constants in `types/firestore/index.ts`. Example:

```typescript
export const COLLECTIONS = {
  HEISTS: 'heists',
  USERS: 'users',
} as const
```

## Required Document Fields

Every document type must include `id`, and `createdAt` as JavaScript `Date` objects:

```typescript
interface SomeEntity {
  id: string
  createdAt: Date
  // ... custom fields with Date types (not Timestamp)
}
```

## Type Patterns

### Document
```typescript
export interface Heist {
  id: string
  createdAt: Date
  // ... custom fields (use Date for date fields)
}
```

### Create Input
Excludes `id` (automatically generated by Firebase):

```typescript
import { FieldValue } from 'firebase/firestore'

export interface CreateHeistInput {
  // Use FieldValue for server-generated timestamps (serverTimestamp())
  createdAt: FieldValue

  // Use Date for calculated dates (e.g., 48 hours from now)
  deadline: Date

  // ... other custom fields
}
```

### Update Input
All fields optional, except for `createdAt` (which shouldn't be present for updates):

```typescript
export interface UpdateHeistInput {
  // ... custom fields, all optional but no createdAt
}
```

## Converters (Timestamp ↔ Date Handling)

Converters automatically handle `Timestamp` ↔ `Date` conversion and use Firestore metadata for timestamps:

```typescript
import { DocumentData, QueryDocumentSnapshot } from 'firebase/firestore'

export const heistConverter = {
  // Simple: just pass data through
  toFirestore: (data: Partial<Heist>): DocumentData => data,

  // Spread data, convert Timestamp fields to Date, use Firestore metadata
  fromFirestore: (snapshot: QueryDocumentSnapshot): Heist => ({
    id: snapshot.id,
    ...snapshot.data(),

    // Convert any Firestore Timestamps to Dates, example:
    createdAt: snapshot.data().createdAt?.toDate(),
    deadline: snapshot.data().deadline?.toDate(),

  } as Heist),
}
```

**Key Points:**
- `toFirestore`: Minimal - just pass data through (Firestore handles Date → Timestamp)
- `fromFirestore`: Use spread syntax, convert custom date fields
- Documents use `Date` types, converters handle all `Timestamp` conversion

**Usage:**
```typescript
const ref = collection(db, COLLECTIONS.HEISTS).withConverter(heistConverter)
const snapshot = await getDocs(ref)
snapshot.forEach(doc => {
  const heist = doc.data() // HeistDocument with Date objects (date-fns compatible!)
})
```

**Important:** `toFirestore` only works with `addDoc` and `setDoc` (with merge). It does NOT work with `updateDoc`.

## Barrel Export

`types/firestore/index.ts`:

```typescript
export * from './heist'
export * from './user'

export const COLLECTIONS = {
  HEISTS: 'heists',
  USERS: 'users',
} as const
```