# Spec for signup-firebase-auth

branch: claude/feature/signup-firebase-auth

## Summary

Wire the existing signup form (`app/(public)/signup/page.tsx`) to Firebase Authentication using the `auth` and `db` exports from `lib/firebase/config.ts`. On successful account creation, the user receives a randomly generated codename (displayName) composed of three words from distinct word sets joined in PascalCase. A corresponding document is created in Firestore's `users` collection storing the user's `id` and `codename` — not their email. Only the Firebase Web SDK may be used (no server-side calls, no third-party auth libraries).

## Functional Requirements

- The signup form submits email and password to `createUserWithEmailAndPassword` from the Firebase Auth Web SDK.
- After account creation, a codename is generated by randomly selecting one word from each of three separate word sets and concatenating them in PascalCase (e.g. `SwiftCrimsonFox`).
- The codename is applied to the Firebase Auth user's `displayName` via `updateProfile`.
- A Firestore document is written to the `users` collection with the document ID equal to the user's `uid`, containing exactly two fields: `id` (the uid) and `codename` (the generated string). The user's email must NOT be stored.
- Word sets must be distinct categories (e.g. adjectives, colours, animals) and contain enough words to produce meaningful variety.
- The three word sets live in a dedicated module/file so they can be maintained independently. The codename generator has no Firebase dependency and lives in `lib/utils/` rather than `lib/firebase/`.
- If `createUserWithEmailAndPassword` fails (e.g. email already in use, weak password), an inline error message is displayed on the form — no alert/toast.
- While the async operation is in flight the submit button shows a loading/disabled state.
- On success, the user is redirected to `/heists` using Next.js router.

## Possible Edge Cases

- Firebase returns `auth/email-already-in-use` — show a friendly "Email is already registered" message.
- Firebase returns `auth/weak-password` — show "Password must be at least 6 characters".
- `updateProfile` fails after account creation — the user account exists but has no displayName; handle gracefully (log error, do not break the flow).
- Firestore write fails after profile update — account and displayName exist but no `users` doc; handle gracefully (log error, do not block the user).
- Two users could theoretically generate the same codename — acceptable for now (not a uniqueness constraint).
- Word sets should be large enough that the codename space is reasonably large (aim for at least 10 words per set → 1,000+ combinations minimum).

## Acceptance Criteria

- Submitting the signup form with a valid email and password creates a Firebase Auth user.
- The created user's `displayName` is a non-empty PascalCase string composed of three words.
- A Firestore document exists at `users/{uid}` with fields `id` and `codename` and no `email` field.
- Submitting with an already-registered email shows an inline error without crashing.
- The submit button is disabled while the request is in flight.
- On successful signup the user is redirected to `/heists`.
- No email address is persisted to Firestore at any point.
- All Firebase calls use the Web SDK only (`firebase/auth`, `firebase/firestore`).

## Open Questions

- Should the generated codename be checked for uniqueness against Firestore before being applied? (Current spec says no — collisions are acceptable for now.)
- ~~What should happen after a successful signup?~~ Resolved: redirect to `/heists`.

## Testing Guidelines

Create `tests/pages/signup.test.tsx` (extend existing file) or a new test file. Test the following without going too heavy:

- Submitting valid credentials calls `createUserWithEmailAndPassword` with the correct email and password.
- After successful submission, `updateProfile` is called with a non-empty `displayName` string matching PascalCase.
- After successful submission, `setDoc` is called with a document containing `id` and `codename` and no `email` field.
- An `auth/email-already-in-use` error from Firebase results in an inline error message being rendered.
- The codename generator unit: given a fixed random seed (or mocked `Math.random`), it returns the expected PascalCase string and never returns an empty string.
